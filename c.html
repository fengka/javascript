<html>
<head>
</head>
<body>
	<script type="text/javascript">

		// each, reduce, filter, map,
		// max, 

		function each(col, iter){
			// col should be array.
			for (var i = 0; i < col.length; i++) {
				iter(col[i], i, col);	
			}
		}

		function reduce(col, iter, memo){

			var begin = 0;
			if (memo === undefined || memo === null) {
				begin = 1;
				memo = col[0];
			}

			for (var i = begin; i < col.length; i++) {
				memo = iter(memo, col[i], i, col);	
			}
			return memo;
		}

		function filter(col, iter){
			var res = [];
			for(var i = 0; i < col.length; i++){
				if(iter(col[i], i, col))
					res.push(col[i]);
			}
			return res;
		}

		function map(col, iter){
			var res = [];
			for(var i = 0; i < col.length; i++){
				res[i] = iter(col[i], i, col);
			}
			return res;
		}

		// test each
		var print = function(e,i,c){ console.log(e); }
		each([4,5,6], print);

		// test reduce
		var sum = function(pre, cur, idx, col){ return pre + cur;}
		var multiply = function(pre, cur, idx, col){ return pre * cur; };
		var greatOrEqual = function(pre, cur, idx, col){ return pre >= cur ? pre : cur; };

		var t1 = reduce([1,2,3,4], sum);
		var m1 = reduce([1,2,3,4], multiply);
		var m2 = reduce([3,2,4,5], greatOrEqual);

		// test filter
		var doubled = function(e,i,c){ return e * 2;}
		var f1 = map([1,2,3,4], doubled);


		// max version 1
		var books = [{title : 'aa', isbn : 111, price : 10}, 
					 {title : 'bb', isbn : 222, price : 30}, 
					 {title : 'cc', isbn : 333, price : 20},
					 {title : 'dd', isbn : 444, price : 10}];

		var maxPrice = function(pre, cur, idx, col){ 
			return pre.price >= cur.price ? pre : cur;
		};
		var p1 = reduce(books, maxPrice);

		// max version 2 :  cond(cur, pre)
		function max(col, cond){

			if (cond === undefined || cond === null)
				cond = function(cur, pre){ return cur >= pre;};	// default is compare by greatOrEqual

			return reduce(col, function(pre, cur, idx, arr){
				return cond(cur, pre) ? cur : pre;  
			});
		}

		var byPrice = function(cur, pre){ return cur.price > pre.price;};
		var p2 = max(books, byPrice);
		var p3 = max(books, function(cur, pre){ return cur.price >= pre.price;});

		var p4 = max([3,4,5,2,1], function(cur, pre){ return cur >= pre;});
		var p5 = max([3,4,6,7,2,4]);

		var words = ['aa', 'bbb', 'cccc', 'd', 'eeee'];
		var byLength = function(cur, pre){ return cur.length >= pre.length;};
		var p6 = max(words, byLength);

		// max version 3. generate a comparable value, compare it by >
		function max_2(col, cond){
			var memo = cond(col[0]);
			each(col, function(e,i,c){
				var computed = cond(e);
				memo = memo >= computed ? memo : computed;
			});

			return memo;
		}

		var p7 = max_2(words, function(w){
			return w.length;
		})

		var byIsbn = function(w){ return w.isbn;}
		var p8 = max_2(books, byIsbn);

		// find
		function find(col, valueFn, bestFn){
			return reduce(col, function(pre, cur, indx, col){
				var curValue = valueFn(cur);
				var bestValue = valueFn(pre);
				var compared = bestFn(curValue, bestValue);

				return bestValue === compared ? pre : cur;
			});
		}

		var byPrice = function(book){return book.price;}
		var cheaper = function(cur, pre){ return cur <= pre ? cur : pre;}
		var p9 = find(books, byPrice, cheaper);

		// best
		function best(col, cond){
			return reduce(col, function(pre, cur, idx, arr){
				return cond(cur, pre) ? cur : pre;
			});
		}
		var cheaper = function(cur, pre){ return cur.price <= pre.price;};
		var p10 = best(books, cheaper);
		var withPrice = function(price){
			return function(e,i,c){ 
				return e.price === price; 
			}
		} 
		var cheapest = p10.price;
		var pAllCheapestBooks = filter(books, withPrice(cheapest));
		//var p11 = best(books, function latest(cur, pre){ });

		// repeat
		function range(start, end, step){

			if(end === undefined && step === undefined){
				end = start;
				start = 0;
				step = 1;
			}

			var res = [];
			var size = Math.ceil((end - start) / step);
			for(var i = 0; i < size; i++)
				res[i] = start + i*step;

			return res;
		}

		function identity(v){return v;}
		function repeat1(times, VALUE){
			return map(range(times), function(){return VALUE;});
		}

		var v1 = repeat1(3,"aaa");

		debugger;

	</script>
</body>
</html>